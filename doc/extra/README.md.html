<!DOCTYPE html>
<html>
  <head>
  <meta charset='UTF-8'>
  <title>CoffeeScript API Documentation</title>
  <script src='../javascript/application.js'></script>
  <script src='../javascript/search.js'></script>
  <link rel='stylesheet' href='../stylesheets/application.css' type='text/css'>
</head>
  <body>
    <div id='base' data-path='../'></div>
<div id='header'>
  <div id='menu'>
    <a href='../extra/README.md.html' title='Angularfire-resource'>
      Angularfire-resource
    </a>
    &raquo;
    <a href='../alphabetical_index.html' title='Index'>
      Index
    </a>
    &raquo;
    <span class='title'>README.md</span>
  </div>
</div>
    <div id='content'>
      <nav class='toc'>
        <p class='title'>
          <a class='hide_toc' href='#'>
            <strong>Table of Contents</strong>
          </a>
          <small>
            (<a class='float_toc' href='#'>left</a>)
          </small>
        </p>
      </nav>
      <div id='filecontents'>
        <h1 id="angularfire-resource">angularfire-resource</h1><p>Resource factory built on top of AngularFire
&gt;</p><blockquote><p>This library is under active development and currently not production ready </p></blockquote><p>FireResource instances are extended <a href="https://www.firebase.com/docs/web/libraries/angular/api.html">firebaseObject</a>, so you&#39;ll find everything you&#39;re used to with angularfire, plus </p><ul>
<li>createdAt / updatedAt timestamps</li>
<li>hooks (beforeCreate, afterCreate, beforeSave, afterSave)</li>
<li>ensure an instance is not retrieved 2 times from firebase</li>
<li>handle associations (hasOne and hasMany, returns respectively a firebaseObject instance or an association collection)</li>
</ul><p>AssociationCollection instances are extended <a href="https://www.firebase.com/docs/web/libraries/angular/api.html">firebaseArray</a>, plus </p><ul>
<li>they are made of FireResource instances</li>
<li>they can preload some of their instances relations (using $include)</li>
<li>they deal nicely with the fireUtil librairy for pagination &amp; infinite scrolling work</li>
</ul>
<h2 id="usage">Usage</h2><p>Set up your relations into a model layer</p><pre><code class="lang-javascript">
angular.module(&#39;myApp&#39;, [&#39;angularfire-resource&#39;])

  .factory(&#39;$firebase&#39;, function() {
    return new Firebase(&#39;https://fireresourcetest.firebaseio.com/&#39;);
  })

  .factory(&#39;User&#39;, function(FireResource, $firebase) {
    return FireResource($firebase.child(&#39;users&#39;))
      .hasMany(&#39;conversations&#39;)
      .hasOne(&#39;displayedConversation&#39;, {className: &#39;Conversation&#39;, inverseOf: false, foreignKey: &#39;displayedConversationId&#39; })
  })

  .factory(&#39;Conversation&#39;, function(FireResource, $firebase) {
    return FireResource($firebase.child(&#39;conversations&#39;), function(){
      this.hasMany(&#39;users&#39;);
      this.hasMany(&#39;messages&#39;, {storedAt: &#39;createdAtDesc&#39; }, function(baseRef, init){ // customize the way you store foreign keys collection to be able to sort data within a relation
        init(new Firebase.util.Scroll(baseRef, &#39;$value&#39;)).$next(5); // use firebase util to handle the pagination 
      });
      this.beforeCreate(function(){        // hooks
        this.createdAtDesc = - Date.now()
      });
    });
  })

  .factory(&#39;Message&#39;, function(FireResource, $firebase) {
    return FireResource($firebase.child(&#39;messages&#39;), function(){
      this.hasOne(&#39;user&#39;, { inverseOf: false }); // no message foreign key into the user model
      this.hasOne(&#39;conversation&#39;);
    });
  })
</code></pre><p>The above code will maintain a deserialized data model with duplicated foreign keys, to allow security enforcement and easy admin queries.</p><pre><code>root
|_ users
| |_ userId1
| | |_ displayedConversationId: conversationId1
| | |_ conversations
| |   |_ conversationId1: true
| |_ userId2
|   |_ conversations
|     |_ conversationId1: true
|
|
|_ conversations
| |_ conversationId1
|   |_users
|   | |_ userId1: true
|   | |_ userId2: true
|   |_ messages
|     |_ messageId1: aCustomValue 
|     |_ messageId2: aCustomValue
|
|
|_ messages
  |_ messageId1
  | |_ userId: userId1
  | |_ conversationId: conversationId1
  |_ messageId2
    |_ userId: userId2
    |_ conversationId: conversationId1
</code></pre><p>And now write some clean controllers :-)</p><pre><code class="lang-javascript">angular.module(&#39;myApp&#39;)

  // $currentUser is an instance of User retrieved from a resolve
  .controller(&#39;ExamplesController&#39;, function($scope, Message, $currentUser){

    // $query on all ( rootUrl/users ) 
    $scope.allUsers = User.$query()

    // $query on some customizing your ref
    $scope.someUsers = User.$query(function(baseRef, init){
      init(new Firebase.util.Scroll(baseRef, &#39;presence&#39;)).$next(10)
    });

    // use $next and $prev to access the scroll instance of your custom ref (if used)
    $scope.loadMoreUsers = function(){
      $scope.someUsers.$next(10)
    };

    // preload associations
    $scope.conversations = $currentUser.$conversations().$include(&#39;messages&#39;)

    $scope.newMessage = Message.$new()
    $scope.saveMessage = function(){
      angular.extend($scope.newMessage, { userId: $currentUser.$id });

      //add an instance to a collection
      $currentUser.$displayedConversation().$messages().$add($scope.newMessage)
      $scope.newMessage = Message.$new();
    };

    $scope.createConversationWith = function(user) {
      // do sequential operations
      return $currentUser.$conversations().$create()
        .then(function (conversation) {
          conversation.$users().$add(user);
        })
  })
</code></pre>
<h2 id="demo">Demo</h2><p>To have a more in depth look over a practical case, check out the demo</p><p><a href="https://fireresourcetest.firebaseapp.com">https://fireresourcetest.firebaseapp.com</a></p><h2 id="api">API</h2>
<h3 id="fireresource">FireResource</h3><p>params : </p><ul>
<li>firebase reference, </li>
<li>options </li>
<li>callback function called in the context of the defined resource (to add methods, relations, or override stuff)</li>
</ul>
<h4 id="resource-hasmany">Resource.hasMany</h4><p>Set a relation one to many</p><p>params :</p><ul>
<li>name : name of the relation</li>
<li>options<ul>
<li><code>className</code> : the targetted class name, default is <code>name.replace(/s$/,&#39;&#39;).camelize(true)</code></li>
<li><code>inverseOf</code>: the inverse relation, default is <code>Resource.$ref().key().replace(/s$/,&#39;&#39;)</code>, <code>false</code> not to maintain foreign key on the related model</li>
<li><code>storedAt</code>: string, object, array of function specifiying how the related instance will be stored in the parent model. Per default it will maintain a set of childKey: true  </li>
</ul>
</li>
</ul><p>Defines the following methods into the parent class : </p><ul>
<li>resource.$name() : get the association array</li>
</ul>
<h4 id="resource-hasone">Resource.hasOne</h4><p>Set a relation one to one or one to many</p><p>params :</p><ul>
<li>name : name of the relation</li>
<li>options<ul>
<li><code>className</code> : the targetted class name, default is <code>name.replace(/s$/,&#39;&#39;).camelize(true)</code></li>
<li><code>inverseOf</code>: the inverse relation, default is <code>Resource.$ref().key().replace(/s$/,&#39;&#39;)</code>, <code>false</code> not to maintain foreign key on the related model</li>
<li><code>foreignKey</code>: specify the property name where the related instance $id will be stored on the Resource instance, default is <code>name.replace(/s$/,&#39;&#39;)+&#39;Id&#39;</code></li>
</ul>
</li>
</ul><p>Defines the following function on the parent class prototype : </p><ul>
<li>$#{name} : get the associated Resource</li>
<li>$set#{name} : set the associated Resource</li>
</ul><p>[to be continued]</p><h2 id="todo">TODO</h2>
<ul>
<li>Close the enhancement issues</li>
<li>Write a readme</li>
<li>Polish the demo</li>
<li>Code some testing</li>
</ul>

      </div>
    </div>
    <div id='footer'>
  September 03, 15 13:35:56 by
  <a href='https://github.com/coffeedoc/codo' title='CoffeeScript API documentation generator'>
    Codo
  </a>
  2.0.10
  &#10034;
  Press H to see the keyboard shortcuts
  &#10034;
  <a href='http://twitter.com/netzpirat' target='_parent'>@netzpirat</a>
  &#10034;
  <a href='http://twitter.com/_inossidabile' target='_parent'>@_inossidabile</a>
</div>
<iframe id='search_frame'></iframe>
<div id='fuzzySearch'>
  <input type='text'>
  <ol></ol>
</div>
<div id='help'>
  <p>
    Quickly fuzzy find classes, mixins, methods, file:
  </p>
  <ul>
    <li>
      <span>T</span>
      Open fuzzy finder dialog
    </li>
  </ul>
  <p>
    Control the navigation frame:
  </p>
  <ul>
    <li>
      <span>L</span>
      Toggle list view
    </li>
    <li>
      <span>C</span>
      Show class list
    </li>
    <li>
      <span>I</span>
      Show mixin list
    </li>
    <li>
      <span>F</span>
      Show file list
    </li>
    <li>
      <span>M</span>
      Show method list
    </li>
    <li>
      <span>E</span>
      Show extras list
    </li>
  </ul>
  <p>
    You can focus and blur the search input:
  </p>
  <ul>
    <li>
      <span>S</span>
      Focus search input
    </li>
    <li>
      <span>Esc</span>
      Blur search input
    </li>
  </ul>
</div>
  </body>
</html>