String.prototype.capitalize=function(){return this.slice(0,1).toUpperCase()+this.slice(1).toLowerCase()},String.prototype.camelize=function(t){var e;return null==t&&(t=!1),e=this.replace(/[\s|_|-](.)/g,function(t){return t.toUpperCase()}).replace(/[\s|_|-]/g,"").replace(/^(.)/,function(t){return t.toLowerCase()}),t?e.slice(0,1).toUpperCase()+e.slice(1):e},angular.module("angularfire-resource",[]);var extend=function(t,e){function n(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;angular.module("angularfire-resource").factory("AssociationFactory",["$injector","$firebaseUtils","AssociationCollection",function(t,e,n){var r,i,o,s,u,a,c,l;return u=function(t){return angular.isObject(t)?t.$id:t},c=function(t){return"$"+t},a=function(t){return"$$"+t},u=function(t){return angular.isObject(t)?t.$id:t},l=function(t,e,n,r){throw"Exception : "+t.$name.camelize(!0)+" "+e+" "+n+", "+r+" is mandatory"},s=function(t,e,n,r){var i,o,s,u;for(u=["className","inverseOf"],i=0,s=u.length;s>i;i++)o=u[i],null==r[o]&&l(t,e,n,o);return"HasMany"!==e&&null==r.foreignKey&&l(t,e,n,"foreignKey"),!0},r=function(){function e(){}return e.prototype.reverseAssociation=function(){return this.inverseOf?this.targetClass()._assoc[this.inverseOf]:void 0},e.prototype.targetClass=function(){return t.get(this.className)},e.prototype.remove=function(){},e.prototype.add=function(){},e}(),i=function(t){function r(t,e,r,i){var o;null==r&&(r={}),this.Resource=t,this.type="HasMany",this.name=e,o=this,r.inverseOf!==!1&&(r.inverseOf||(r.inverseOf=this.Resource.$name.replace(/s$/,""))),r.className||(r.className=e.replace(/s$/,"").camelize(!0)),s(this.Resource,this.type,e,r),angular.extend(this,r),this.Resource.prototype[c(e)]=function(t){return t||!this[a(e)]?(this[a(e)]&&this[a(e)].$destroy(),this[a(e)]=new n(o,this,t||i)):this[a(e)]}}return extend(r,t),r.prototype.remove=function(t,n){var r;return r=e.defer(),this.Resource.$ref().child(u(n.from)).child(name).child(u(t)).set(null,e.makeNodeResolver(r)),r.promise.then(function(){return t})},r.prototype.add=function(t,n){var r,i;return r=e.defer(),i=function(t,e,n){var r,o,s,u;if(angular.isArray(t)){for(u={},r=0,s=t.length;s>r;r++)o=t[r],u[o]=i(o,e,n);return u}return angular.isFunction(t)?t.call(e,n):angular.isString(t)?angular.isFunction(n[t])?n[t](e):n[t]:!0},this.Resource.$ref().child(u(n.to)).child(this.name).child(u(t)).set(i(this.storedAt,n.to,t),e.makeNodeResolver(r)),r.promise.then(function(){return t})},r}(r),o=function(t){function n(t,n,r){var i;null==r&&(r={}),this.Resource=t,this.type="HasOne",this.name=n,r.inverseOf!==!1&&(r.inverseOf||(r.inverseOf=t.$name)),r.className||(r.className=n.camelize(!0)),r.foreignKey||(r.foreignKey=n+"Id"),s(t,this.type,n,r),angular.extend(this,r),i=this,t.prototype[c(n)]=function(){var t;return null!=this[i.foreignKey]?this[t=a(n)]||(this[t]=i.targetClass().$find(this[i.foreignKey])):null},t.prototype[c("create"+n.camelize(!0))]=function(t){return i.targetClass().$create(t).then(function(t){return function(e){return t[c("set"+n.camelize(!0))](e)}}(this))},t.prototype[c("set"+n.camelize(!0))]=function(t){var r,o;return o=this[i.foreignKey],r=angular.isObject(t)?t.$id:t,t=angular.isObject(t)?t:null!=t?i.targetClass().$find(t):null,e.resolve(o===r).then(function(t){return t?e.reject():void 0}).then(function(e){return function(){return e[i.foreignKey]=r,e[a(n)]=t,i.add(t,{to:e})}}(this)).then(function(t){return function(){return o&&i.reverseAssociation()?i.reverseAssociation().remove(t,{from:o}):void 0}}(this)).then(function(e){return function(){return t&&i.reverseAssociation()?i.reverseAssociation().add(e,{to:t}):void 0}}(this)).then(function(e){return function(){return t}}(this))["catch"](function(){return t})}}return extend(n,t),n.prototype.remove=function(t,n){var r;return r=e.defer(),this.Resource.$ref().child(u(n.from)).child(this.foreignKey).once("value",function(n){return n.val()!==t.$id?n.ref().set(null,e.makeNodeResolver(r)):void 0}),r.promise.then(function(){return t})},n.prototype.add=function(t,n){var r;return r=e.defer(),this.Resource.$ref().child(u(n.to)).child(this.foreignKey).set(u(t),e.makeNodeResolver(r)),r.promise.then(function(){return t})},n}(r),{HasOne:o,HasMany:i}}]);var extend=function(t,e){function n(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;angular.module("angularfire-resource").factory("Collection",["$firebaseArray","$firebaseUtils",function(t,e){var n;return n=function(){function n(t,e){return this.$$targetClass=t,this.$$init(this.$$targetClass.$ref(),e),this.$list}return n.prototype.$loaded=function(){return t.prototype.$loaded.apply(this,arguments).then(function(t){return function(){var n,r,i,o,s;for(i=[],s=t.$list,n=0,o=s.length;o>n;n++)r=s[n],i.push(r.$loaded());return e.allPromises(i)}}(this))},n.prototype.$include=function(t){return this.$loaded().then(function(e){return function(){var n,r,i,o,s;for(e.$$includes=t,o=e.$list,s=[],n=0,i=o.length;i>n;n++)r=o[n],s.push(r.$include(e.$$includes));return s}}(this)),this},n.prototype.$next=function(t){var n;return this.$ref().scroll?(n=e.defer(),this.$ref().scroll.hasNext()?(this.$ref().once("value",function(t){return function(){return t.$loaded().then(function(){return n.resolve(t)})}}(this)),this.$ref().scroll.next(t)):n.resolve(this),n.promise):!1},n.prototype.$prev=function(t){var n;return this.$ref().scroll?(n=e.defer(),this.$ref().scroll.hasPrev()?(this.$ref().once("value",function(t){return function(){return t.$loaded().then(function(){return n.resolve(t)})}}(this)),this.$ref().scroll.prev(t)):n.resolve(this),n.promise):!1},n.prototype.$$init=function(e,n){var r,i;return i=this,r=function(e){return t.call(i,e),i},null!=n?n.call(this,e,r):r(e)},n.prototype.$$added=function(e){var n;return n=t.prototype.$$added.apply(this,arguments),n?this.$$targetClass.$find(e.key()).$include(this.$$includes):n},n.prototype.$$updated=function(t){return!1},n}(),t.$extend(n)}]).factory("AssociationCollection",["$firebaseArray","$injector","Collection","$firebaseUtils",function(t,e,n,r){var i;return i=function(e){function n(t,e,n){var r;if(this.$$association=t,this.$$targetClass=t.targetClass(),this.$$parentRecord=e,this.$$parentRecord.$isNew())throw"Association Error : parent instance should be saved";return r=this.$$parentRecord.$ref().child(this.$$association.name),this.$$init(r,n),this.$list}return extend(n,e),n.prototype.$create=function(t){return this.$$association.targetClass().$create(t).then(function(t){return function(e){return t.$add(e)}}(this))},n.prototype.$add=function(t){return r.resolve(t.$isNew()?t.$save():void 0).then(function(e){return function(){return-1!==e.$indexFor(t.$id)?r.reject():void 0}}(this)).then(function(e){return function(){return e.$$association.add(t,{to:e.$$parentRecord})}}(this)).then(function(t){return function(e){return t.$$association.reverseAssociation()?t.$$association.reverseAssociation().add(t.$$parentRecord,{to:e}):void 0}}(this))["catch"](function(){return console.log("resource allready in the collection")}).then(function(){return t})},n.prototype.$remove=function(e){return t.prototype.$remove.call(this,e).then(function(t){return function(){return t.$$association.reverseAssociation()?t.$$association.reverseAssociation().remove(t.$$parentRecord,{from:e}):void 0}}(this))["catch"](function(t){return function(){return console.log(t.$$association.name.camelize(!0),t.$$parentRecord.$id,t.$$association.name,arguments)}}(this)).then(function(){return e})},n}(n)}]),angular.module("angularfire-resource").factory("FireResource",["$firebaseObject","$firebaseUtils","Collection","AssociationFactory",function(t,e,n,r){return function(i,o,s){var u;return null==o&&(o={}),angular.isFunction(o)&&(s=o,o={}),u=function(){function u(e){h[e.key()]=this,t.call(this,e),this.$$isNew=!1,this.$$loaded=!1,this.$include(o.includes)}var a,c,l,f,h,$;for(h={},u._assoc={},u.$name=o.name||i.key().replace(/s$/,""),u.$ref=function(){return i},u.$query=function(t){return new n(u,t)},u.$new=function(t){var e;return null==t&&(t={}),null!=t.id?(e=new this(this.$ref().child(t.id)),delete t.id):e=new this(this.$ref().push()),e.$$isNew=!0,angular.extend(e,t),e},u.$create=function(t){return null==t&&(t={}),this.$new(t).$save()},u.$find=function(t,e){var n;return null==e&&(e={}),n=h[t]?h[t]:new u(u.$ref().child(t)),null!=e.includes&&n.$includes(e.includes),n},u.hasMany=function(t,e,n){return null==e&&(e={}),this._assoc[t]=new r.HasMany(this,t,e,n),this},u.hasOne=function(t,e){return null==e&&(e={}),this._assoc[t]=new r.HasOne(this,t,e),this},$=["beforeCreate","beforeSave","afterSave","afterCreate"],c=function(t){return u["_"+t]=[],u[t]=function(e){return u["_"+t].push(e),this}},l=0,f=$.length;f>l;l++)a=$[l],c(a);return u.clearMap=function(){var t,e,n;n=[];for(e in h)t=h[e],n.push(t.$destroy());return n},u.prototype.$isNew=function(){return this.$$isNew},u.prototype.$loaded=function(){return t.prototype.$loaded.apply(this,arguments).then(function(t){return function(){return t.$$loadIncludes()}}(this)).then(function(t){return function(){return t.$$loaded=!0,t}}(this))},u.prototype.$save=function(){var n,r,i;return n=arguments,r=this.$isNew(),i=this,e.resolve().then(function(){return r?i.$$runCallbacks("beforeCreate"):void 0}).then(function(){return i.$$runCallbacks("beforeSave")}).then(function(){return r&&(i.createdAt=Firebase.ServerValue.TIMESTAMP),i.updatedAt=Firebase.ServerValue.TIMESTAMP}).then(function(){return t.prototype.$save.apply(i,n)}).then(function(){return r?i.$$runCallbacks("afterCreate"):void 0}).then(function(){return i.$$runCallbacks("afterSave")}).then(function(){return i})},u.prototype.$include=function(t){return this.$$setIncludes(t),this.$loaded(),this},u.prototype.$destroy=function(){var e,n,r;r=this.constructor._assoc;for(n in r)e=r[n],null!=this["$$"+n]&&this["$$"+n].$destroy();return t.prototype.$destroy.apply(this,arguments),delete h[this.$id]},u.prototype.$update=function(t){return angular.extend(this,t),this.$save()},u.prototype.$$loadIncludes=function(){var t,n,r,i;r=[],i=this.$$includes;for(t in i)n=i[t],n===!0?r.push(this["$"+t]().$loaded()):r.push(this["$"+t](n).$loaded());return e.allPromises(r)},u.prototype.$$setIncludes=function(t){var e,n,r,i;if(this.$$includes||(this.$$includes={}),angular.isString(t))return this.$$includes[t]=!0;if(angular.isArray(t)){for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(this.$$setIncludes(e));return i}return angular.isObject(t)?angular.extend(this.$$includes,t):void 0},u.prototype.$$updated=function(n){var r,i,o,s,u;this.$$isNew&&n.val()&&(this.$$isNew=!1),o=e.toJSON(this),u=t.prototype.$$updated.apply(this,arguments),s=this.constructor._assoc;for(i in s)r=s[i],"HasOne"===r.type&&null!=this["$$"+i]&&this[r.foreignKey]!==o[r.foreignKey]&&(this["$$"+i]=null,this["$"+i]());return u},u.prototype.$$runCallbacks=function(t){var n,r,i,o,s,u,a;for(s=e.resolve(),a=this,u=this.constructor["_"+t],r=function(t){return s=s.then(function(){return t.apply(a,[a])})},i=0,o=u.length;o>i;i++)n=u[i],angular.isString(n)&&(n=this[n]),r(n);return s},t.$extend(u),null!=s&&s.call(u),u}()}}]);